var M=Object.defineProperty;var E=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var k=(i,s,l)=>s in i?M(i,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[s]=l,I=(i,s)=>{for(var l in s||(s={}))N.call(s,l)&&k(i,l,s[l]);if(E)for(var l of E(s))O.call(s,l)&&k(i,l,s[l]);return i};var u=(i,s,l)=>new Promise((d,b)=>{var g=m=>{try{f(l.next(m))}catch(n){b(n)}},C=m=>{try{f(l.throw(m))}catch(n){b(n)}},f=m=>m.done?d(m.value):Promise.resolve(m.value).then(g,C);f((l=l.apply(i,s)).next())});import{F as U}from"./Form-D_p7JRAU.js";import{u as $}from"./useForm-DeuCuIY6.js";import{u as j}from"./useValidator-CECEZWWG.js";import{i as q,c as G}from"./index-BdvF35nf.js";import{g as K}from"./index-ClR_H9bl.js";/* empty css                  */import"./IconPicker-PZ8eWYgt.js";/* empty css                        *//* empty css                    *//* empty css               */import{_ as W}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-DoofpGzT.js";import{a7 as H,a8 as v,B as L,l as J,d as P,ad as Q,c as X}from"./element-plus-BmqQxCtl.js";import{l as Y,a as V,I as _,u as y,M as t,U as w,O as x,b as Z,m as ee,p as le}from"./vue-chunks-ApmF_VrE.js";const he=Y({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(i,{expose:s}){const{t:l}=G(),{required:d}=j(),b=i,g=a=>u(this,null,function*(){var o;const e=yield c();p({permissionList:(o=e==null?void 0:e.permissionList)==null?void 0:o.filter(S=>S.value!==a.value)})}),C=a=>u(this,null,function*(){n.value=I({},a)}),f=()=>u(this,null,function*(){var o;const a=yield c(),e=(o=a==null?void 0:a.permissionList)==null?void 0:o.findIndex(S=>S.id===n.value.id);e!==-1&&(a.permissionList[e]=I({},n.value),n.value=null)}),m=V(!1),n=V(null),T=_([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:a=>u(this,null,function*(){const e=yield c();a===1?(r([{field:"component",path:"componentProps.disabled",value:!1}]),p({component:y(h)})):(r([{field:"component",path:"componentProps.disabled",value:!0}]),e.parentId===void 0?p({component:"#"}):p({component:"##"}))})}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:a=>u(this,null,function*(){var o;const e=yield c();a&&e.type===0?p({component:"##"}):!a&&e.type===0?p({component:"#"}):e.type===1&&p({component:(o=y(h))!=null?o:""})})}},optionApi:()=>u(this,null,function*(){return(yield K()).data.list||[]})},{field:"meta.title",label:l("menu.menuName"),component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:a=>{h.value=a}}}},{field:"name",label:l("menu.name"),component:"Input"},{field:"meta.icon",label:l("menu.icon"),component:"Input"},{field:"path",label:l("menu.path"),component:"Input"},{field:"meta.activeMenu",label:l("menu.activeMenu"),component:"Input"},{field:"status",label:l("menu.status"),component:"Select",componentProps:{options:[{label:l("userDemo.disable"),value:0},{label:l("userDemo.enable"),value:1}]}},{field:"permissionList",label:l("menu.permission"),component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:a=>t(x,null,[t(q,{class:"m-t-5px",type:"primary",size:"small",onClick:()=>m.value=!0},{default:()=>[w("添加权限")]}),t(H,{data:a==null?void 0:a.permissionList},{default:()=>[t(v,{type:"index",prop:"id"},null),t(v,{prop:"value",label:"Value"},{default:({row:e})=>n.value&&n.value.id===e.id?t(L,{modelValue:n.value.value,"onUpdate:modelValue":o=>n.value.value=o,size:"small"},null):t("span",null,[e.value])}),t(v,{prop:"label",label:"Label"},{default:({row:e})=>n.value&&n.value.id===e.id?t(L,{modelValue:n.value.label,"onUpdate:modelValue":o=>n.value.label=o,size:"small"},null):t(J,{class:"mr-1",key:e.value},{default:()=>[e.label]})}),t(v,{label:"Operations",width:"180"},{default:({row:e})=>n.value&&n.value.id===e.id?t(P,{size:"small",type:"primary",onClick:f},{default:()=>[w("确定")]}):t(x,null,[t(P,{size:"small",type:"primary",onClick:()=>C(e)},{default:()=>[w("编辑")]}),t(Q,{title:"Are you sure to delete this?",onConfirm:()=>g(e)},{reference:()=>t(P,{size:"small",type:"danger"},{default:()=>[w("删除")]})})])})]})])}}},{field:"meta.hidden",label:l("menu.hidden"),component:"Switch"},{field:"meta.alwaysShow",label:l("menu.alwaysShow"),component:"Switch"},{field:"meta.noCache",label:l("menu.noCache"),component:"Switch"},{field:"meta.breadcrumb",label:l("menu.breadcrumb"),component:"Switch"},{field:"meta.affix",label:l("menu.affix"),component:"Switch"},{field:"meta.noTagsView",label:l("menu.noTagsView"),component:"Switch"},{field:"meta.canTo",label:l("menu.canTo"),component:"Switch"}]),F=_({component:[d()],path:[d()],"meta.title":[d()]}),{formRegister:R,formMethods:B}=$(),{setValues:p,getFormData:c,getElFormExpose:D,setSchema:r}=B,z=()=>u(this,null,function*(){const a=yield D();if(yield a==null?void 0:a.validate().catch(o=>{}))return yield c()}),h=V("");Z(()=>b.currentRow,a=>{if(!a)return;const e=X(a);h.value=e.type===1?e.component:"",e.parentId===0?r([{field:"component",path:"componentProps.disabled",value:!0}]):r([{field:"component",path:"componentProps.disabled",value:!1}]),e.type===1?r([{field:"component",path:"componentProps.disabled",value:!1}]):r([{field:"component",path:"componentProps.disabled",value:!0}]),p(e)},{deep:!0,immediate:!0}),s({submit:z});const A=a=>u(this,null,function*(){const e=yield c();p({permissionList:[...(e==null?void 0:e.permissionList)||[],a]})});return(a,e)=>(ee(),le(x,null,[t(y(U),{rules:F,onRegister:y(R),schema:T},null,8,["rules","onRegister","schema"]),t(W,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),onConfirm:A},null,8,["modelValue"])],64))}});export{he as _};
